<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="UTF-8" />
  <title>Shop</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

  <div class="coin-display">
    ðŸ’° <span id="coinCount">0</span>
  </div>

  <h1>Welcome to the Shop!</h1>
  <button class="button" onclick="window.location.href='index.html'">Back to Home</button>

  <div class="card-pack-grid">
    <!-- Loop through packs if needed for cleaner structure in the future -->
    <div class="card-slot-container">
      <img src="images/generalist pack.png" class="card-image" alt="Generalist Pack">
      <div class="card-label">Generalist Pack - 150 coins</div>
      <button onclick="buyPack('generalist', 150)">Buy</button>
    </div>
    <!-- Add similar divs for other packs... -->
    <!-- Kept all other pack entries same for brevity -->
  </div>

  <!-- Pack Opening Modal -->
  <div id="pack-opening" class="pack-opening hidden">
    <div class="burst-pack">
      <img id="pack-image" src="" alt="Pack" class="pack-image">
      <p id="click-prompt" class="click-prompt">Click!</p>
      <img id="card-image" src="" alt="Card" class="card-image" style="display:none;">
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyANtfKFonwEu6ewUS6yNYM8qZBkf2aFcIo",
      authDomain: "card-game-51dd7.firebaseapp.com",
      projectId: "card-game-51dd7",
      storageBucket: "card-game-51dd7.appspot.com",
      messagingSenderId: "1059333480213",
      appId: "1:1059333480213:web:9787cdf5da0242aebf531c",
      databaseURL: "https://card-game-51dd7-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let currentUserId = null, currentCoins = 0;

    auth.onAuthStateChanged(user => {
      if (!user) return window.location.href = 'index.html';
      currentUserId = user.uid;
      db.ref(`users/${currentUserId}/coins`).on('value', snap => {
        currentCoins = snap.val() || 0;
        document.getElementById('coinCount').textContent = currentCoins;
      });
    });

    function buyPack(name, cost) {
      if (currentCoins < cost) return alert("Not enough coins!");
      const uref = db.ref(`users/${currentUserId}`);
      uref.transaction(userData => {
        if (!userData || (userData.coins || 0) < cost) return userData;
        userData.coins -= cost;
        userData.packs = userData.packs || {};
        userData.packs[name] = (userData.packs[name] || 0) + 1;
        return userData;
      }).then(() => triggerPackOpening(name));
    }

    function getRandomCardFromGeneralist() {
      const rand = Math.random() * 100;
      let cardNum;
      if (rand < 85) cardNum = Math.floor(Math.random() * 43) + 1;
      else if (rand < 95) cardNum = Math.floor(Math.random() * 6) + 44;
      else if (rand < 99) cardNum = Math.floor(Math.random() * 6) + 50;
      else cardNum = Math.floor(Math.random() * 6) + 56;
      return `images/card-${String(cardNum).padStart(3, '0')}.PNG`;
    }

    function triggerPackOpening(name) {
      const modal = document.getElementById('pack-opening');
      const imgPack = document.getElementById('pack-image');
      const imgCard = document.getElementById('card-image');
      const prompt = document.getElementById('click-prompt');

      const ext = name === 'generalist' ? 'png' : 'jpg';
      imgPack.src = `images/${name} pack.${ext}`;
      imgCard.style.display = 'none';
      imgCard.src = '';
      prompt.textContent = "Click!";
      modal.classList.remove('hidden');

      let clicks = 0, opened = false;
      const finalCard = name === 'generalist' ? getRandomCardFromGeneralist() : 'images/card-placeholder.jpg';

      imgPack.onclick = () => {
        if (opened) return;
        clicks++;
        imgPack.style.transform = 'scale(1.1)';
        setTimeout(() => imgPack.style.transform = 'scale(1)', 150);
        if (clicks >= 3) {
          opened = true;
          imgCard.src = finalCard;
          imgCard.style.display = 'block';
          prompt.textContent = "";
        }
      };

      modal.onclick = e => {
        if (opened && e.target === modal) {
          modal.classList.add('hidden');
          imgPack.onclick = null;
        }
      };
    }
  </script>
</body>
</html>